---
layout : post
title: Redis主从复制
category : Redis
duoshuo: true
math: true
date : 2015-1-26
---

<!-- more -->

Redis是一个高性能的key-value内存数据库，官网：[http://redis.io/](http://redis.io/)。

##主从复制的特点
Redis数据库和其他一些数据库一样，拥有主从复制（master-slave replication）的功能。
Redis的主从复制主要的特点有：
>
1.一个主节点（master）可以拥有多个从节点（slave），同时从节点还可以拥有自己的从节点。
2.主从复制功能不会阻塞主节点： 即使有一个或多个从节点正在进行初次同步， 主节点也可以继续处理命令请求。
3.主从复制功能也不会阻塞从节点： 只要在配置文件中进行了相应的设置， 即使从节点正在进行初次同步，也可以使用旧版本的数据集来处理命令查询。

##主从复制原理
无论是初次连接还是重新连接， 当建立一个从服务器时， 从服务器都将向主服务器发送一个 SYNC 命令。
接到 SYNC 命令的主服务器将开始执行 BGSAVE ， 并在保存操作执行期间， 将所有新执行的写入命令都保存到一个缓冲区里面。
当 BGSAVE 执行完毕后， 主服务器将执行保存操作所得的 .rdb 文件发送给从服务器， 从服务器接收这个 .rdb 文件， 并将文件中的数据载入到内存中。
之后主服务器会以 Redis 命令协议的格式， 将写命令缓冲区中积累的所有内容都发送给从服务器。

##配置
**1、使用命令**
slaveof <masterip> <masterport> 例如：
slaveof 192.168.1.24 6379 配置当前Redis节点为IP为192.168.1.24 端口为6379的Redis节点的从节点
这种配置方法在从节点重启后失效，如果需要保证长久的主从关系一般需要修改配置文件。
**2、配置文件**
在配置文件中新增：
slaveof 192.168.1.24 6379 同样也可以达到如上的作用。

##其他功能
**1、只读从节点**
将从节点设置为只读，主从之间形成了读写分离的模式，保证了数据的安全性，提高了数据的操作速度。另外，还可以在从节点上做数据备份，以减轻主节点的压力。
**2、requirepass**
如果主服务器通过 requirepass 选项设置了密码， 那么为了让从服务器的同步操作可以顺利进行， 我们也必须为从服务器进行相应的身份验证设置。
对于一个正在运行的服务器， 可以使用客户端输入以下命令：
config set masterauth <password>
要永久地设置这个密码， 那么可以将它加入到配置文件中：
masterauth <password>
**3、主服务器只在有至少 N 个从服务器的情况下，才执行写操作**
从 Redis 2.8 开始， 为了保证数据的安全性， 可以通过配置， 让主服务器只在有至少 N 个当前已连接从服务器的情况下， 才执行写命令。







